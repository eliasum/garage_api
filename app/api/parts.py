# 2026.01.13 12:22 IMM

# –†–û–£–¢–ï–† –î–õ–Ø –ó–ê–ü–ß–ê–°–¢–ï–ô

from typing import Any, Dict

from app.database import garage  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –û–î–ò–ù —ç–∫–∑–µ–º–ø–ª—è—Ä
from app.schemas.part import PartCreate, PartResponse  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ –ø–∞–ø–∫–∏ schemas
from fastapi import APIRouter, Depends, HTTPException

# 4. –°–û–ó–î–ê–ù–ò–ï –†–û–£–¢–ï–†–ê –î–õ–Ø –ó–ê–ü–ß–ê–°–¢–ï–ô
# APIRouter ‚Äî –≥—Ä—É–ø–ø–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
# prefix="/parts" ‚Äî –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –±—É–¥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å /parts
# tags=["parts"] ‚Äî –≥—Ä—É–ø–ø–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Swagger
router = APIRouter(prefix="/parts", tags=["parts"])


# ‚úÖ Dependency Injection –ë–ï–ó –¶–ò–ö–õ–ò–ß–ï–°–ö–û–ì–û –ò–ú–ü–û–†–¢–ê
def get_garage():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä garage"""
    return garage  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç


# 5. –≠–ù–î–ü–û–ò–ù–¢ –°–û–ó–î–ê–ù–ò–Ø –ó–ê–ü–ß–ê–°–¢–ò (POST)
# @router.post ‚Äî –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, —É–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ POST –∏ –ø—É—Ç—å
# "/" ‚Äî –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞ (/parts + / = /parts/)
# –¢.–µ. –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –±—É–¥–µ—Ç: /parts/
# response_model=PartResponse ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ö–µ–º—É –æ—Ç–≤–µ—Ç–∞
# part: PartCreate ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
@router.post("/", response_model=PartResponse)
async def create_part(
    part: PartCreate,
    garage_instance=Depends(get_garage),  # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å
):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø—á–∞—Å—Ç—å"""  # –î–û–ö–°–¢–†–ò–ù–ì (—Å—Ç—Ä–æ–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Swagger UI)
    # 1. –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç—å –≤ –≥–∞—Ä–∞–∂
    garage_instance.add_part(part.name, part.part_number, part.quantity)

    # 2. –ù–∞—Ö–æ–¥–∏–º —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–ø—á–∞—Å—Ç—å
    # (–ø–æ—Å–ª–µ–¥–Ω—è—è –≤ —Å–ø–∏—Å–∫–µ, —Ç–∞–∫ –∫–∞–∫ add_part –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ–Ω–µ—Ü)
    created_part = garage_instance.parts[-1]

    # 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–ø—á–∞—Å—Ç—å
    return {
        "id": created_part.id,
        "name": created_part.name,
        "part_number": created_part.part_number,
        "quantity": created_part.quantity,
    }
    # REST API Convention (—Å–æ–≥–ª–∞—à–µ–Ω–∏–µ):
    # –ö–æ–≥–¥–∞ –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ —á—Ç–æ-—Ç–æ —á–µ—Ä–µ–∑ POST, —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
    # HTTP —Å—Ç–∞—Ç—É—Å 201 Created (–∞ –Ω–µ 200 OK)
    # Location –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å URL –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
    # –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞


# 9. –≠–ù–î–ü–û–ò–ù–¢ –°–ü–ò–°–ö–ê –ó–ê–ü–ß–ê–°–¢–ï–ô (GET /parts)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–ø—á–∞—Å—Ç–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
@router.get("/")
def list_parts(
    garage_instance=Depends(get_garage),
) -> Dict[str, Any]:  # –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    parts = garage_instance.list_parts()

    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç—ã Part –≤ —Å–ª–æ–≤–∞—Ä–∏
    parts_list = []
    for part in parts:
        parts_list.append(
            {
                "id": part.id,
                "name": part.name,
                "part_number": part.part_number,
                "quantity": part.quantity,
            }
        )

    return {"total": len(parts_list), "parts": parts_list}


# 10. –≠–ù–î–ü–û–ò–ù–¢ –ü–û–õ–£–ß–ï–ù–ò–Ø –ö–û–ù–ö–†–ï–¢–ù–û–ô –ó–ê–ü–ß–ê–°–¢–ò (GET /parts/{part_id})
# {part_id} ‚Äî path parameter (–ø–∞—Ä–∞–º–µ—Ç—Ä –ø—É—Ç–∏)
@router.get("/{part_id}")
def get_part(part_id: int, garage_instance=Depends(get_garage)):
    part = garage_instance.find_part(part_id)
    if not part:
        # HTTPException ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ HTTP –æ—à–∏–±–∫—É
        raise HTTPException(
            status_code=404, detail=f"–ó–∞–ø—á–∞—Å—Ç—å —Å ID {part_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        )
    return part  # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ JSON


# # –†–ê–ó–ë–û–† –ö–û–î–ê –°–û–ó–î–ê–ù–ò–Ø –ó–ê–ü–ß–ê–°–¢–ò
# # üéØ –°–¢–†–û–ö–ê 1: –î–ï–ö–û–†–ê–¢–û–† (–æ–±—ä—è–≤–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞)
# @router.post("/", response_model=PartResponse)
# # ‚îÇ      ‚îÇ    ‚îÇ            ‚îÇ
# # ‚îÇ      ‚îÇ    ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ 5. "–§–û–†–ú–ê –û–¢–í–ï–¢–ê" ‚Äî FastAPI –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å,
# # ‚îÇ      ‚îÇ    ‚îÇ                   —á—Ç–æ –æ—Ç–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ö–µ–º–µ PartResponse
# # ‚îÇ      ‚îÇ    ‚îÇ
# # ‚îÇ      ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ 4. –ü–£–¢–¨ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞ "/parts" ‚Üí –∏—Ç–æ–≥–æ–≤—ã–π –ø—É—Ç—å /parts/
# # ‚îÇ      ‚îÇ           "/" –∑–Ω–∞—á–∏—Ç "–∫–æ—Ä–µ–Ω—å –ø—Ä–µ—Ñ–∏–∫—Å–∞"
# # ‚îÇ      ‚îÇ
# # ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ 3. –ú–ï–¢–û–î –ó–ê–ü–†–û–°–ê ‚Äî POST (—Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
# # ‚îÇ            –î—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã: GET, PUT, DELETE, PATCH
# # ‚îÇ
# # ‚îî‚îÄ‚îÄ‚îÄ 2. "–ê–¢" ‚Äî —Å–∏–º–≤–æ–ª –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä = "–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞" –Ω–∞–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π.
# #       –û–Ω –≥–æ–≤–æ—Ä–∏—Ç: "–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ POST –∑–∞–ø—Ä–æ—Å–æ–≤"

# # üéØ –°–¢–†–û–ö–ê 2: –û–ë–™–Ø–í–õ–ï–ù–ò–ï –§–£–ù–ö–¶–ò–ò-–û–ë–†–ê–ë–û–¢–ß–ò–ö–ê
# async def create_part(part: PartCreate):
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ      ‚îÇ
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ 9. –¢–ò–ü –ü–ê–†–ê–ú–ï–¢–†–ê ‚Äî Pydantic —Å—Ö–µ–º–∞ PartCreate
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ           FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ           1. –ü—Ä–æ—á–∏—Ç–∞–µ—Ç JSON –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ           2. –ü—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ —Å—Ö–µ–º–µ PartCreate
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ           3. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –æ–±—ä–µ–∫—Ç PartCreate
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ           4. –ü–µ—Ä–µ–¥–∞—Å—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îÇ
# # ‚îÇ    ‚îÇ            ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ 8. –ò–ú–Ø –ü–ê–†–ê–ú–ï–¢–†–ê ‚Äî "part" (–º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º)
# # ‚îÇ    ‚îÇ            ‚îÇ
# # ‚îÇ    ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ 7. –ò–ú–Ø –§–£–ù–ö–¶–ò–ò ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º, –Ω–æ –ª—É—á—à–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º
# # ‚îÇ    ‚îÇ
# # ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ 6. –ö–õ–Æ–ß–ï–í–û–ï –°–õ–û–í–û "async" ‚Äî –æ–±—ä—è–≤–ª—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
# # ‚îÇ          –í FastAPI –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async/await –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å:
# # ‚îÇ          ‚Ä¢ –ë–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
# # ‚îÇ          ‚Ä¢ –î—Ä—É–≥–∏–º–∏ API
# # ‚îÇ          ‚Ä¢ –§–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
# # ‚îÇ          –ù–æ –ú–û–ñ–ù–û –∏ –±–µ–∑ async! –ü—Ä–æ—Å—Ç–æ def create_part(part: PartCreate):
# # ‚îÇ
# # ‚îî‚îÄ‚îÄ‚îÄ 5. –ö–õ–Æ–ß–ï–í–û–ï –°–õ–û–í–û "def" ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∫–∞–∫ –≤ C#)

# # üéØ –°–¢–†–û–ö–ê 3: –î–û–ö–°–¢–†–ò–ù–ì (—Å—Ç—Ä–æ–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
#     """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø—á–∞—Å—Ç—å"""
#     # –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Swagger UI

# # üéØ –°–¢–†–û–ö–ò 4-6: –¢–ï–õ–û –§–£–ù–ö–¶–ò–ò (–ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
#     # 1. –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Å—Ç—å –≤ –≥–∞—Ä–∞–∂
#     garage.add_part(part.name, part.part_number, part.quantity)
#     #    ‚îÇ           ‚îÇ   ‚îÇ      ‚îÇ   ‚îÇ            ‚îÇ   ‚îÇ
#     #    ‚îÇ           ‚îÇ   ‚îÇ      ‚îÇ   ‚îÇ            ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ 13. quantity –∏–∑ –æ–±—ä–µ–∫—Ç–∞ part
#     #    ‚îÇ           ‚îÇ   ‚îÇ      ‚îÇ   ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ 12. –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–æ–ª—é part_number
#     #    ‚îÇ           ‚îÇ   ‚îÇ      ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ 11. –û–ë–™–ï–ö–¢ part (—Å–æ–∑–¥–∞–Ω FastAPI –∏–∑ JSON)
#     #    ‚îÇ           ‚îÇ   ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ 10. –ú–ï–¢–û–î add_part –∫–ª–∞—Å—Å–∞ Garage
#     #    ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ 9. –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–æ–ª—é name –æ–±—ä–µ–∫—Ç–∞ part
#     #    ‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ 8. –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è garage (—Å–æ–∑–¥–∞–Ω–∞ –≤ –Ω–∞—á–∞–ª–µ main.py)
#     #    ‚îî‚îÄ‚îÄ‚îÄ 7. –í–´–ó–û–í –ú–ï–¢–û–î–ê ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø—á–∞—Ç—å –≤ —Å–ø–∏—Å–æ–∫

#     # 2. –ù–∞—Ö–æ–¥–∏–º —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–ø—á–∞—Å—Ç—å
#     created_part = garage.parts[-1]
#     #                  ‚îÇ       ‚îÇ
#     #                  ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ 15. –ò–ù–î–ï–ö–° -1 = –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞
#     #                  ‚îî‚îÄ‚îÄ‚îÄ 14. –°–ü–ò–°–û–ö parts –≤–Ω—É—Ç—Ä–∏ –æ–±—ä–µ–∫—Ç–∞ garage

#     # 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–ø—á–∞—Å—Ç—å
#     return {
#         "id": created_part.id,
#         "name": created_part.name,
#         "part_number": created_part.part_number,
#         "quantity": created_part.quantity,
#     }
#     # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —ç—Ç–æ—Ç —Å–ª–æ–≤–∞—Ä—å –≤ JSON
#     # –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –∫–ª–∏–µ–Ω—Ç—É —Å HTTP —Å—Ç–∞—Ç—É—Å–æ–º 200 OK

# –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –ø–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

# 1. –ë—Ä–∞—É–∑–µ—Ä ‚Üí http://localhost:8000/parts/
# 2. FastAPI –∏—â–µ—Ç: "–ö—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç POST /parts/?"
# 3. –ù–∞—Ö–æ–¥–∏—Ç: "–ê, —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è create_part –≤ —Ä–æ—É—Ç–µ—Ä–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º /parts!"
# 4. –ß–∏—Ç–∞–µ—Ç JSON –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
# 5. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ PartCreate —Å—Ö–µ–º—É
# 6. –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é create_part
# 7. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ JSON
